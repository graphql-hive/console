extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.3", import: ["@key", "@tag", "@shareable"])
directive @tag(name: String!) repeatable on FIELD_DEFINITION | OBJECT

"""
Represents a user account in the system
"""
type User @key(fields: "id") @key(fields: "email") {
  """
  Unique identifier for the user
  """
  id: ID!
  """
  User's email address (tagged as PII for data privacy compliance)
  """
  email: String! @tag(name: "pii")
  """
  User's full name
  """
  name: String
  """
  User's display alias or username
  """
  alias: String
  """
  Total number of products created by this user
  """
  totalProductsCreated: Int @shareable
  """
  Timestamp when the user account was created
  """
  createdAt: DateTime
  """
  List of all notifications for this user
  """
  notifications: [Notification!]!
}

"""
ISO-8601 formatted date and time string
"""
scalar DateTime

"""
Types of notifications that can be sent to users
"""
enum NotificationType {
  """
  Notification about a product update
  """
  PRODUCT_UPDATE
  """
  Notification when a new review is posted
  """
  REVIEW_POSTED
  """
  Welcome notification for new users
  """
  WELCOME
}

"""
Filter criteria for searching notifications
"""
input NotificationFilterInput {
  """
  Search text to match against notification messages
  """
  searchText: String
  """
  Filter by specific notification types
  """
  types: [NotificationType!]
  """
  Only include notifications from this date onwards
  """
  dateFrom: DateTime
  """
  Only include notifications up to this date
  """
  dateTo: DateTime
}

"""
Input for creating a new user account
"""
input CreateUserInput {
  """
  User's email address (required)
  """
  email: String!
  """
  User's full name (required)
  """
  name: String!
  """
  Optional display alias or username
  """
  alias: String
}

"""
Input for updating an existing user account
"""
input UpdateUserInput {
  """
  Updated full name
  """
  name: String
  """
  Updated display alias or username
  """
  alias: String
}

"""
Base interface for all notification types
"""
interface NotificationItf {
  id: ID!
  message: String!
}

"""
Notification sent when a product is updated
"""
type ProductUpdateNotification implements NotificationItf {
  """
  Unique identifier for the notification
  """
  id: ID!
  """
  Human-readable notification message
  """
  message: String!
  """
  The product that was updated
  """
  product: Product!
  """
  Timestamp when the product was updated
  """
  updatedAt: DateTime!
}

"""
Notification sent when a review is posted
"""
type ReviewPostedNotification implements NotificationItf {
  """
  Unique identifier for the notification
  """
  id: ID!
  """
  Human-readable notification message
  """
  message: String!
  """
  The review that was posted
  """
  review: Review!
  """
  Timestamp when the review was posted
  """
  postedAt: DateTime!
}

"""
Welcome notification sent to new users
"""
type WelcomeNotification implements NotificationItf {
  """
  Unique identifier for the notification
  """
  id: ID!
  """
  Human-readable notification message
  """
  message: String!
  """
  Timestamp when the notification was created
  """
  createdAt: DateTime!
}

"""
Product stub reference (full definition in products subgraph)
"""
type Product @key(fields: "upc") {
  """
  Universal Product Code
  """
  upc: String!
}

"""
Review stub reference (full definition in reviews subgraph)
"""
type Review @key(fields: "id") {
  """
  Unique identifier for the review
  """
  id: ID!
}

"""
Union of all possible notification types
"""
union Notification = ProductUpdateNotification | ReviewPostedNotification | WelcomeNotification

extend type Query {
  me: User
  user(id: ID!): User
  users: [User]
  notification(id: ID!): Notification
  notifications: [Notification!]!
  searchNotifications(filter: NotificationFilterInput!): [Notification!]!
}

extend type Mutation {
  createUser(input: CreateUserInput!): User!
  updateUser(id: ID!, input: UpdateUserInput!): User
}
