extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.3", import: ["@key", "@tag", "@shareable"])
directive @tag(name: String!) repeatable on FIELD_DEFINITION | OBJECT

type User @key(fields: "id") @key(fields: "email") {
  id: ID!
  email: String! @tag(name: "pii")
  name: String
  alias: String
  totalProductsCreated: Int @shareable
  createdAt: DateTime
  notifications: [Notification!]!
}

scalar DateTime

enum NotificationType {
  PRODUCT_UPDATE
  REVIEW_POSTED
  WELCOME
}

input NotificationFilterInput {
  searchText: String
  types: [NotificationType!]
  dateFrom: DateTime
  dateTo: DateTime
}

input CreateUserInput {
  email: String!
  name: String!
  alias: String
}

input UpdateUserInput {
  name: String
  alias: String
}

interface NotificationItf {
  id: ID!
  message: String!
}

type ProductUpdateNotification implements NotificationItf {
  id: ID!
  message: String!
  product: Product!
  updatedAt: DateTime!
}

type ReviewPostedNotification implements NotificationItf {
  id: ID!
  message: String!
  review: Review!
  postedAt: DateTime!
}

type WelcomeNotification implements NotificationItf {
  id: ID!
  message: String!
  createdAt: DateTime!
}

type Product @key(fields: "upc") {
  upc: String!
}

type Review @key(fields: "id") {
  id: ID!
}

union Notification = ProductUpdateNotification | ReviewPostedNotification | WelcomeNotification

extend type Query {
  me: User
  user(id: ID!): User
  users: [User]
  notification(id: ID!): Notification
  notifications: [Notification!]!
  searchNotifications(filter: NotificationFilterInput!): [Notification!]!
}

extend type Mutation {
  createUser(input: CreateUserInput!): User!
  updateUser(id: ID!, input: UpdateUserInput!): User
}
