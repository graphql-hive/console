import { Callout, Cards, Tabs } from '@theguild/components'

# Usage Reporting

Hive Router can send usage reports to Hive Console to provide insights into the operations being
executed against your GraphQL API. This includes details such as operation names, client
information, and field-level usage statistics.

The Hive Router can report usage metrics to the Hive schema registry, giving you
[insights for executed GraphQL operations](/docs/dashboard/insights), and
[field level usage information](/docs/dashboard/explorer), but also enabling
[conditional breaking changes](/docs/management/targets#conditional-breaking-changes).

Before proceeding, make sure you have
[created a registry token with write permissions on the Hive dashboard](/docs/management/targets#registry-access-tokens).

You can either provide the usage reporting configuration via environment variables or the
`router.config.yaml` file.

<Tabs items={["Environment Variables", "Configuration File"]}>

{/* Environment Variables */}

<Tabs.Tab>

- `HIVE__USAGE_REPORTING__TARGET_ID`: The target ID, this can either be a slug following the format
  `$organizationSlug/$projectSlug/$targetSlug` (e.g `the-guild/graphql-hive/staging`) or an UUID
  (e.g. `a0f4c605-6541-4350-8cfe-b31f21a4bf80`). To be used when the token is configured with an
  organization access token.

- `HIVE__USAGE_REPORTING__TOKEN`: Your
  [Registry Access Token](https://the-guild.dev/graphql/hive/docs/management/targets#registry-access-tokens)
  with write permission.

```sh filename="Run Hive Router with Usage Reporting enabled."
HIVE__USAGE_REPORTING__TOKEN="<hive_usage_access_token>" \
  HIVE__USAGE_REPORTING__TARGET_ID="<hive_usage_target>" \
  hive-router
```

</Tabs.Tab>

{/* Configuration File */}

<Tabs.Tab>

Alternatively, you can provide the usage reporting configuration via the `router.config.yaml` file.

```yaml filename="router.config.yaml"
usage_reporting:
  # The registry token provided by Hive Registry
  token: '<hive_usage_access_token>'
  # The registry target which the usage data should be reported to defaulting to process.env.HIVE_USAGE_TARGET
  # This can either be a slug following the format `$organizationSlug/$projectSlug/$targetSlug` (e.g `the-guild/graphql-hive/staging`)
  # or an UUID (e.g. `a0f4c605-6541-4350-8cfe-b31f21a4bf80`).
  target_id: '<hive_usage_target>'

  # Endpoint override for self-hosting
  # endpoint: 'https://my-hive-instance.com/usage'
```

</Tabs.Tab>

</Tabs>

If you want to control the usage reporting to the Hive Console like `client_name_header`,
`client_version_header` or `sample_rate` etc, please look at the Hive Client documentation to learn
more about other options.
[See more in Hive Client reference](/docs/router/configuration/usage_reporting).
